# 2019/09/23

## SE-342

### 计算机图形学笔记

回忆上节课：提到了「用直方图来进行图像增强」。没讲完。咱们接着来说？

### 直方图均衡化

对于 像素频率 - 灰度级别 直方图中，如果灰度级别比较集中，实际表现就是对比度低，没有什么亮-暗的对比。

我们想一些办法把原来的灰度级别做一个 (A, B) -> (C, D) 的拉伸映射，就可以让灰度分布范围更广，明暗对比更加强烈，显示效果相对更好一些。

具体一点的操作时：将原图像的直方图通过变换函数修整成较为均衡的直方图。

注意，这个修正和空间无关（因为直方图也不包含空间信息），所做的事情只是重新映射灰度级别频率图而已。因此是全图生效的。

#### 怎么实现？

r 代表归一化的灰度级别（最大值为 1），P(r) 为原图中对应灰度级别 r 中的频率。

现在我们想要把直方图给修正成一个更好看（更均衡、更平直）的直方图。并且要保证倾向性不变，即原来暗的地方也还是要相对较暗，亮的地方也要相对较亮。

又因为灰度的变换不应该影响像素的分布和像素数量，因此变换前后对 p(r) 做积分（如果是离散情况，那就是直接求和）得到的像素数量应该保持不变。

#### 问题

这种 Re-mapping 的问题是：我们的变换函数很可能会导致有一些原来分开的灰度级别合并，但是我们绝对没有可能去把原来合并的灰度级别给拆成两个（直方图均衡化的实质决定不能做到）。因此结果就是会造成 Discrete，丢失细节信息。甚至我们都不知道丢失了哪个位置的信息。因为直方图根本不知道位置信息。

### 局部直方图均衡化

我们有了一个解决方案：AHE（Adaptive Histogram Equalization）。

对于每一个像素点，我们都取出靠近他的一个稍大的方形，对其中这一小块做局部的直方图均衡化。最后，再移动到下一个像素，再次进行直方图均衡化。

这就是 AHE……

这有什么好处呢？

之前我们的 Mapping 是会在全局损失信息的。也就是说，如果有一块很亮的地方，他就会吃掉暗部的大量信息。因为在直方图中他们并不能被区分开。

如果我们分开进行局部均衡化的话，因为在一小块的范围内很难出现很大的明暗反差，因此就能尽量少的损失细节，也能增加整体的灰度级别（不一样的小块可以产生不一样的灰度级别）。

1985 年 AHE 算法就由 Pizer 提出来了…

但实际上分块计算的代价是更大的。极大地增加了计算复杂度。

#### 优化 AHE

对于那些亮度类似的部分，我们直接将其分成一整块是不是能节约些时间呢？

因此我们就使用聚类来进行分块，再对每一块进行 AHE 就能节约时间，并且不显著影响 AHE 的结果。

#### AHE: Desired Histogram

我们还有另一种方法来实现 Re-mapping:

先给出你希望得到的（Desired）直方图图形，（但保证积分结果跟原来的直方图的积分结果相同），然后将每一个灰度级别按照积分的数量对应到另一个灰度级别（保证像素数量及以及相对关系不改变），一点点对应构成一张映射表（Table）。最后按照这张表重新分配灰度级别就实现了 HE。

### 图像的增强：图像平滑

平滑嘛…大概就是清除掉图像里面的一些噪音，一些不平滑的、坑坑洼洼的 Noise。

分为两种：一种是空间域的平滑，另外一种是频域的平滑。

我们今天仅仅考虑空间域的平滑。

#### 空间域平滑／局部平均法

计算快，实现简单，结果「比较令人满意」（看你要求高不高了）

简单局部平均法：

假定 `g(x, y) = f(x, y) + n(x, y)`，其中 n(x, y) 就是噪音。

我们需要

`g(x, y) = 1/M * Sum(g(x, y) nearby's M points)`

基本假设：图像的噪音可加的、均值为 0 的、与图像信号无关的。

简单进行这种操作毫无疑问会导致图像变模糊…轮廓边缘尤甚。
